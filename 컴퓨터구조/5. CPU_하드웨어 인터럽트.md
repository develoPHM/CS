# cpu 하드웨어 인터럽트

cpu는 효율적으로 명령어를 처리하기 위해 하드웨어 인터럽트를 사용합니다.

예를들어 CPU가 프린터에 프린트를 명령했다면, 일반적으로 입출력장치의 속도는 CPU에 비해 현저히 느려서 CPU는 입출력 작업의 결과를 바로 받아 볼 수 없습니다. 하드웨어 인터럽트를 사용하지 않는다면 CPU는 프린터가 언제 프린트를 끝낼지 모르기 때문에 주기적으로 완료 여부를 확인해야 합니다. 끝날때까지 무작정 기다리는 상황과 같습니다.

하지만 하드웨어 인터럽트를 사용하면 CPU는 작업이 끝나기를 기다릴 필요 없이 프린트가 진행되는 동안 온전히 다른 작업을 처리할 수 있게 됩니다. 하드웨어 인터럽트는 CPU낭비를 최소화하고, CPU가 다른 일을 수행할 수 있는 시간을 벌어 줌으로써 효율적으로 명령어 처리할 수 있도록 돕습니다.

## 하드웨어 인터럽트 처리 순서

1. 입출력 장치는 CPU 에게 **인터럽트 요천 신호**를 보냄
2. CPU 는 실행 사이클이 끝나고 명령어를 인출하기 전에 **항상 인터럽트 여부를 확인**함
3. CPU 는 인터럽트 요청을 확인하고, **인터럽트 플래그**를 통해 현재 인터럽트를 받아들일 수 있는지 여부를 확인함
4. 인터럽트를 받아들일 수 있다면 CPU 가 지금까지의 **작업을 백업**합니다.
5. CPU 는 **인터럽트 벡터를 참조하여 인터럽트 서비스 루틴을 실행**합니다.
6. 인터럽트 서비스 루틴 실행이 끝나면 4번에서 백업해 둔 작업을 **복구하여 실행을 재개**합니다.

## 인터럽트 설명

인터럽트는 CPU 의 정상적인 실행 흐름을 끊는 것이기 때문에 인터럽트하기 전에 CPU 에게 인터럽트 가능 여부를 확인해야함, 이를 **인터럽트 요청신호**( interrupt request) 라고 함.

이때 CPU 가 인터럽트 요청을 수용하기 위해서는 플래그 레지스터의 **인터럽트 플래그**가 활성화되어 있어야 합니다. 인터럽트 플래그는 하드웨어 인터럽트를 받아들일지, 무시할지를 결정하는 플래그입니다. 인터럽트 플래그가 불가능으로 설정되어 있다면 CPU 는 인터럽트 요청이 오더라도 해당 요청을 무시합니다. 다만 불가능으로 설정되어 있더라도 무시할 수 없는 인터럽트 요청도 있습니다. 무시할 수 없는 하드웨어 인터럽트는 가장 우선순위가 높은, 즉 가장 먼저 처리해야 하는 인터럽트를 말함.

정전이나 하드웨어 고장으로 인한 인터럽트가 이에 해당함.

CPU 가 입터럽트 요청을 받아들이면 CPU는 **인터럽트 서비스 루틴**이라는 프로그램을 실행합니다.

인터럽트 서비스 루틴은 인터럽트를 처리하기 위한 프로그램으로, **인터럽트 핸들러** 라고도 부릅니다. 인터럽트 서비스 루틴은 **어떤 인터럽트가 발생했을 때 해당 인터럽트를 어떻게 처리하고 작동해야 할지에 대한 정보로 이루어진 프로그램** 입니다. **CPU 가 인터럽트를 처리한다는 말은 인터럽트 서비스 루틴을 실행하고, 본래 수행하던 작업으로 다시 되돌아온다는 말과 같습니다.**

입출력장치마다 인터럽트를 처리하기 위한 동작이 다르므로 입출력 장치마다 각기 다른 인터럽트 서비스 루틴을 가지고 있습니다. 메모리에는 여러 개의 인터럽트 서비스 루틴들이 저장되어 있고, **각각이 인터럽트가 발생하면 어떻게 행동해야 할지를 알려 주는 프로그램** 이라고 보면 됩니다.

인터럽트 벡터는 **인터럽트 서비스 루틴을 식별하기 위한 정보입니다.** CPU 는 하드웨어 인터럽트 요청을 보낸 대상으로부터 버스를 통해 인터럽트 벡터를 전달받습니다. 인터럽트 벡터가 인터럽트 서비스 루틴의 시작 주소를 포함하고 있기 때문에 CPU는 인터럽트 벡터를 통해 처음부터 특정 인터럽트 서비스 루틴을 실행할 수 있습니다.

정리하자면, CPU 가 인터럽트를 처리하는 것은 인터럽트 서비스 루틴을 실행하고, 본래 수행하던 작업으로 다시 되돌아온다는 말과 같습니다. CPU 가 인터럽트 서비스 루틴을 실행하려면 인터럽트 서비스 루틴의 시작 주소를 알아야 하며, 이는 인터럽트 벡터를 통해 알 수 있습니다. 그리고 인터럽트 서비스 루틴이 끝나면 **되돌아와서 마저 수행되어야 하는 작업을 해야 하므로 어딘가에** **백업**해 둬야 합니다. 그러므로 인터럽트 서비스 루틴을 실행하기 전에 프로그램 카운터 값 등 현재 프로그램을 **재개하기 위해** 필요한 모든 내용을 **메모리 내 스택**에 백업합니다.